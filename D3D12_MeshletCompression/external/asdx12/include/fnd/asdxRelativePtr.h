//-----------------------------------------------------------------------------
// File : asdxRelativePtr.h
// Desc : Relative Pointer.
// Copyright(c) Project Asura. All right reserved.
//-----------------------------------------------------------------------------
#pragma once

//-----------------------------------------------------------------------------
// Includes
//-----------------------------------------------------------------------------
#include <cstdint>
#include <cassert>


namespace asdx {

///////////////////////////////////////////////////////////////////////////////
// RelativePtr class
///////////////////////////////////////////////////////////////////////////////
template<typename T>
class RelativePtr
{
    //=========================================================================
    // list of friend classes and methods.
    //=========================================================================
    /* NOTHING */

public:
    //=========================================================================
    // public variables.
    //=========================================================================
    /* NOTHING */

    //=========================================================================
    // public methods.
    //=========================================================================

    //-------------------------------------------------------------------------
    //! @brief      コンストラクタです.
    //-------------------------------------------------------------------------
    RelativePtr() = default;

    //-------------------------------------------------------------------------
    //! @brief      データを取得します.
    //-------------------------------------------------------------------------
    const T* Get() const
    {
        assert(m_Offset != 0);
        return reinterpret_cast<T*>(uintptr_t(this) + m_Offset);
    }

    //-------------------------------------------------------------------------
    //! @brief      アロー演算子です.
    //-------------------------------------------------------------------------
    const T* operator->() const
    { return Get(); }

    //-------------------------------------------------------------------------
    //! @brief      インデクサです.
    //-------------------------------------------------------------------------
    const T& operator[] (uint32_t index) const
    { return Get()[index]; }

    //-------------------------------------------------------------------------
    //! @brief      間接参照演算子です.
    //-------------------------------------------------------------------------
    const T& operator* () const
    { return *Get(); }

    //-------------------------------------------------------------------------
    //! @brief      ブール演算子です.
    //! 
    //! @retval true    非nullです.
    //! @retval false   nullです.
    //-------------------------------------------------------------------------
    operator bool () const
    { return m_Offset != 0; }

    //-------------------------------------------------------------------------
    //! @brief      null かどうかチェックします.
    //! 
    //! @retval true    nullです.
    //! @retval false   非nullです.
    //-------------------------------------------------------------------------
    bool IsNull() const
    { return m_Offset == 0; }

    //-------------------------------------------------------------------------
    //! @brief      オフセットを設定します.
    //! 
    //! @param[in]      offset      設定するオフセット値.
    //-------------------------------------------------------------------------
    void SetOffset(uint32_t offset)
    { m_Offset = offset; }

private:
    //=========================================================================
    // private variables.
    //=========================================================================
    uint32_t m_Offset = 0;  //!< オフセット値.

    //=========================================================================
    // private methods.
    //=========================================================================
    /* NOTHING */
};

} // namespace asdx
