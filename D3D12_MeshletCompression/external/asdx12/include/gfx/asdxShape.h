//-----------------------------------------------------------------------------
// File : asdxShape.h
// Desc : Debug Shapes.
// Copyright(c) Project Asura. All right reserved.
//-----------------------------------------------------------------------------
#pragma once

//-----------------------------------------------------------------------------
// Includes
//-----------------------------------------------------------------------------
#include <d3d12.h>
#include <fnd/asdxMath.h>
#include <fnd/asdxRef.h>


namespace asdx {

///////////////////////////////////////////////////////////////////////////////
// ShapeParam structure
///////////////////////////////////////////////////////////////////////////////
struct ShapeParam
{
    asdx::Matrix    World;  //!< ワールド行列です.
    asdx::Vector4   Color;  //!< シェイプカラーです.
};

///////////////////////////////////////////////////////////////////////////////
// ShapeStates class
///////////////////////////////////////////////////////////////////////////////
class ShapeStates
{
    //=========================================================================
    // list of friend classes and methods.
    //=========================================================================
    /* NOTHING */

public:
    //=========================================================================
    // public variables.
    //=========================================================================
    /* NOTHING */

    //=========================================================================
    // public methods.
    //=========================================================================

    //-------------------------------------------------------------------------
    //! @brief      コンストラクタです.
    //-------------------------------------------------------------------------
    ShapeStates();

    //-------------------------------------------------------------------------
    //! @brief      デストラクタです.
    //-------------------------------------------------------------------------
    ~ShapeStates();

    //-------------------------------------------------------------------------
    //! @brief      初期化処理を行います.
    //-------------------------------------------------------------------------
    bool Init(ID3D12Device* pDevice, DXGI_FORMAT colorFormat, DXGI_FORMAT depthFormat);

    //-------------------------------------------------------------------------
    //! @brief      終了処理を行います.
    //-------------------------------------------------------------------------
    void Term();

    //-------------------------------------------------------------------------
    //! @brief      ビュー行列と射影行列を設定します.
    //-------------------------------------------------------------------------
    void SetMatrix(const asdx::Matrix& view, const asdx::Matrix& proj);

    //-------------------------------------------------------------------------
    //! @brief      不透明ステートを適用します.
    //! 
    //! @param[in]      pCmd        コマンドリストです.
    //-------------------------------------------------------------------------
    void ApplyOpaqueState(ID3D12GraphicsCommandList* pCmd);

    //-------------------------------------------------------------------------
    //! @brief      半透明ステートを適用します.
    //! 
    //! @param[in]      pCmd        コマンドリストです.
    //-------------------------------------------------------------------------
    void ApplyTranslucentState(ID3D12GraphicsCommandList* pCmd);

    //-------------------------------------------------------------------------
    //! @brief      ワイヤーフレームステートを適用します.
    //! 
    //! @param[in]      pCmd        コマンドリストです.
    //-------------------------------------------------------------------------
    void ApplyWireframeState(ID3D12GraphicsCommandList* pCmd);

private:
    //=========================================================================
    // private variables.
    //=========================================================================
    asdx::RefPtr<ID3D12RootSignature>   m_RootSignature;
    asdx::RefPtr<ID3D12PipelineState>   m_OpaqueState;
    asdx::RefPtr<ID3D12PipelineState>   m_TranslucentState;
    asdx::RefPtr<ID3D12PipelineState>   m_WireframeState;
    asdx::RefPtr<ID3D12Resource>        m_CameraBuffer;
    uint8_t                             m_BufferIndex = 0;
    asdx::Matrix                        m_View;
    asdx::Matrix                        m_Proj;

    //=========================================================================
    // public methods.
    //=========================================================================
    D3D12_GPU_VIRTUAL_ADDRESS UpdateParam();
};

///////////////////////////////////////////////////////////////////////////////
// ShapeBase class
///////////////////////////////////////////////////////////////////////////////
class ShapeBase
{
    //=========================================================================
    // list of friend classes and methods.
    //=========================================================================
    /* NOTHING */

public:
    //=========================================================================
    // public variables.
    //=========================================================================
    /* NOTHING */

    //=========================================================================
    // public methods.
    //=========================================================================

    //-------------------------------------------------------------------------
    //! @brief      コンストラクタです.
    //-------------------------------------------------------------------------
    ShapeBase();

    //-------------------------------------------------------------------------
    //! @brief      デストラクタです.
    //-------------------------------------------------------------------------
    ~ShapeBase();

    //-------------------------------------------------------------------------
    //! @brief      ワールド行列を設定します.
    //-------------------------------------------------------------------------
    void SetWorld(const asdx::Matrix& value);

    //-------------------------------------------------------------------------
    //! @brief      カラーを設定します.
    //-------------------------------------------------------------------------
    void SetColor(const asdx::Vector4& value);

    //-------------------------------------------------------------------------
    //! @brief      ワールド行列を取得します.
    //-------------------------------------------------------------------------
    const asdx::Matrix& GetWorld() const;

    //-------------------------------------------------------------------------
    //! @brief      カラーを取得します.
    //-------------------------------------------------------------------------
    const asdx::Vector4& GetColor() const;

    //-------------------------------------------------------------------------
    //! @brief      描画処理を行います.
    //-------------------------------------------------------------------------
    void Draw(ID3D12GraphicsCommandList* pCmd);

protected:
    //=========================================================================
    // protected variables.
    //=========================================================================
    asdx::RefPtr<ID3D12Resource>    m_VB;               //!< 頂点バッファです.
    asdx::RefPtr<ID3D12Resource>    m_IB;               //!< インデックスバッファです.
    asdx::RefPtr<ID3D12Resource>    m_CB;               //!< 定数バッファです.
    D3D12_VERTEX_BUFFER_VIEW        m_VBV         = {}; //!< 頂点バッファビューです.
    D3D12_INDEX_BUFFER_VIEW         m_IBV         = {}; //!< インデックスバッファビューです.
    ShapeParam                      m_Param       = {}; //!< シェイプパラメータです.
    uint8_t                         m_BufferIndex = 0;  //!< バッファインデックです.
    uint32_t                        m_IndexCount  = 0;  //!< インデックス数です.

    //=========================================================================
    // protected methods.
    //=========================================================================
    bool InitBuffer(
        ID3D12Device*           pDevice,
        const asdx::Vector3*    positions,
        size_t                  positionCount,
        const uint32_t*         indices,
        size_t                  indexCount);

    //-------------------------------------------------------------------------
    //! @brief      バッファを破棄します.
    //-------------------------------------------------------------------------
    void Reset();

    //-------------------------------------------------------------------------
    //! @brief      シェイプパラメータを更新します.
    //-------------------------------------------------------------------------
    D3D12_GPU_VIRTUAL_ADDRESS UpdateParam();
};

///////////////////////////////////////////////////////////////////////////////
// BoxShape class
///////////////////////////////////////////////////////////////////////////////
class BoxShape : public ShapeBase
{
    //=========================================================================
    // list of friend classes and methods.
    //=========================================================================
    /* NOTHING */

public:
    //=========================================================================
    // public variables.
    //=========================================================================
    /* NOTHING */

    //=========================================================================
    // public methods.
    //=========================================================================

    //-------------------------------------------------------------------------
    //! @brief      コンストラクタです.
    //-------------------------------------------------------------------------
    BoxShape();

    //-------------------------------------------------------------------------
    //! @brief      デストラクタです.
    //-------------------------------------------------------------------------
    ~BoxShape();

    //-------------------------------------------------------------------------
    //! @brief      初期化処理を行います.
    //-------------------------------------------------------------------------
    bool Init(ID3D12Device* pDevice, float size);

    //-------------------------------------------------------------------------
    //! @brief      終了処理を行います.
    //-------------------------------------------------------------------------
    void Term();
};

///////////////////////////////////////////////////////////////////////////////
// SphereShape class
///////////////////////////////////////////////////////////////////////////////
class SphereShape : public ShapeBase
{
    //=========================================================================
    // list of friend classes and methods.
    //=========================================================================
    /* NOTHING */

public:
    //=========================================================================
    // public variables.
    //=========================================================================
    /* NOTHING */

    //=========================================================================
    // public methods.
    //=========================================================================

    //-------------------------------------------------------------------------
    //! @brief      コンストラクタです.
    //-------------------------------------------------------------------------
    SphereShape();

    //-------------------------------------------------------------------------
    //! @brief      デストラクタです.
    //-------------------------------------------------------------------------
    ~SphereShape();

    //-------------------------------------------------------------------------
    //! @brief      初期化処理を行います.
    //-------------------------------------------------------------------------
    bool Init(ID3D12Device* pDevice, float radius, uint32_t sliceCount);

    //-------------------------------------------------------------------------
    //! @brief      終了処理を行います.
    //-------------------------------------------------------------------------
    void Term();
};

///////////////////////////////////////////////////////////////////////////////
// HemisphereShape class
///////////////////////////////////////////////////////////////////////////////
class HemisphereShape : public ShapeBase
{
    //=========================================================================
    // list of friend classes and methods.
    //=========================================================================
    /* NOTHING */

public:
    //=========================================================================
    // public variables.
    //=========================================================================
    /* NOTHING */

    //=========================================================================
    // public methods.
    //=========================================================================

    //-------------------------------------------------------------------------
    //! @brief      コンストラクタです.
    //-------------------------------------------------------------------------
    HemisphereShape();

    //-------------------------------------------------------------------------
    //! @brief      デストラクタです.
    //-------------------------------------------------------------------------
    ~HemisphereShape();

    //-------------------------------------------------------------------------
    //! @brief      初期化処理を行います.
    //-------------------------------------------------------------------------
    bool Init(ID3D12Device* pDevice, float radius, uint32_t sliceCount);

    //-------------------------------------------------------------------------
    //! @brief      終了処理を行います.
    //-------------------------------------------------------------------------
    void Term();
};

///////////////////////////////////////////////////////////////////////////////
// ConeShape class
///////////////////////////////////////////////////////////////////////////////
class ConeShape : public ShapeBase
{
    //=========================================================================
    // list of friend classes and methods.
    //=========================================================================
    /* NOTHING */

public:
    //=========================================================================
    // public variables.
    //=========================================================================
    /* NOTHING */

    //=========================================================================
    // public methods.
    //=========================================================================

    //-------------------------------------------------------------------------
    //! @brief      コンストラクタです.
    //-------------------------------------------------------------------------
    ConeShape();

    //-------------------------------------------------------------------------
    //! @brief      デストラクタです.
    //-------------------------------------------------------------------------
    ~ConeShape();

    //-------------------------------------------------------------------------
    //! @brief      初期化処理を行います.
    //-------------------------------------------------------------------------
    bool Init(ID3D12Device* pDevice, float height, float radius, uint32_t sliceCount);

    //-------------------------------------------------------------------------
    //! @brief      終了処理を行います.
    //-------------------------------------------------------------------------
    void Term();
};

///////////////////////////////////////////////////////////////////////////////
// PyramidShape class
///////////////////////////////////////////////////////////////////////////////
class PyramidShape : public ShapeBase
{
    //=========================================================================
    // list of friend classes and methods.
    //=========================================================================
    /* NOTHING */

public:
    //=========================================================================
    // public variables.
    //=========================================================================
    /* NOTHING */

    //=========================================================================
    // public methods.
    //=========================================================================

    //-------------------------------------------------------------------------
    //! @brief      コンストラクタです.
    //-------------------------------------------------------------------------
    PyramidShape();

    //-------------------------------------------------------------------------
    //! @brief      デストラクタです.
    //-------------------------------------------------------------------------
    ~PyramidShape();

    //-------------------------------------------------------------------------
    //! @brief      初期化処理を行います.
    //-------------------------------------------------------------------------
    bool Init(ID3D12Device* pDevice, float length, float width);

    //-------------------------------------------------------------------------
    //! @brief      終了処理を行います.
    //-------------------------------------------------------------------------
    void Term();
};

///////////////////////////////////////////////////////////////////////////////
// CylinderShape class
///////////////////////////////////////////////////////////////////////////////
class CylinderShape : public ShapeBase
{
    //=========================================================================
    // list of friend classes and methods.
    //=========================================================================
    /* NOTHING */

public:
    //=========================================================================
    // public variables.
    //=========================================================================
    /* NOTHING */

    //=========================================================================
    // public methods.
    //=========================================================================

    //-------------------------------------------------------------------------
    //! @brief      コンストラクタです.
    //-------------------------------------------------------------------------
    CylinderShape();

    //-------------------------------------------------------------------------
    //! @brief      デストラクタです.
    //-------------------------------------------------------------------------
    ~CylinderShape();

    //-------------------------------------------------------------------------
    //! @brief      初期化処理を行います.
    //-------------------------------------------------------------------------
    bool Init(ID3D12Device* pDevice, float radius, float height, uint32_t sliceCount);

    //-------------------------------------------------------------------------
    //! @brief      終了処理を行います.
    //-------------------------------------------------------------------------
    void Term();
};

///////////////////////////////////////////////////////////////////////////////
// PlaneShape class
///////////////////////////////////////////////////////////////////////////////
class PlaneShape : public ShapeBase
{
    //=========================================================================
    // list of friend classes and methods.
    //=========================================================================
    /* NOTHING */

public:
    //=========================================================================
    // public variables.
    //=========================================================================
    /* NOTHING */

    //=========================================================================
    // public methods.
    //=========================================================================

    //-------------------------------------------------------------------------
    //! @brief      コンストラクタです.
    //-------------------------------------------------------------------------
    PlaneShape();

    //-------------------------------------------------------------------------
    //! @brief      デストラクタです.
    //-------------------------------------------------------------------------
    ~PlaneShape();

    //-------------------------------------------------------------------------
    //! @brief      初期化処理を行います.
    //-------------------------------------------------------------------------
    bool Init(ID3D12Device* pDevice, float width, float height);

    //-------------------------------------------------------------------------
    //! @brief      終了処理を行います.
    //-------------------------------------------------------------------------
    void Term();
};

///////////////////////////////////////////////////////////////////////////////
// CapsuleShape class
///////////////////////////////////////////////////////////////////////////////
class CapsuleShape : public ShapeBase
{
    //=========================================================================
    // list of friend classes and methods.
    //=========================================================================
    /* NOTHING */

public:
    //=========================================================================
    // public variables.
    //=========================================================================
    /* NOTHING */

    //=========================================================================
    // public methods.
    //=========================================================================

    //-------------------------------------------------------------------------
    //! @brief      コンストラクタです.
    //-------------------------------------------------------------------------
    CapsuleShape();

    //-------------------------------------------------------------------------
    //! @brief      デストラクタです.
    //-------------------------------------------------------------------------
    ~CapsuleShape();

    //-------------------------------------------------------------------------
    //! @brief      初期化処理を行います.
    //-------------------------------------------------------------------------
    bool Init(ID3D12Device* pDevice, float length, float radius, uint32_t sliceCount);

    //-------------------------------------------------------------------------
    //! @brief      終了処理を行います.
    //-------------------------------------------------------------------------
    void Term();
};

///////////////////////////////////////////////////////////////////////////////
// DiskShape class
///////////////////////////////////////////////////////////////////////////////
class DiskShape : public ShapeBase
{
    //=========================================================================
    // list of friend classes and methods.
    //=========================================================================
    /* NOTHING */
public:
    //=========================================================================
    // public variables.
    //=========================================================================
    /* NOTHING */

    //=========================================================================
    // public methods.
    //=========================================================================

    //-------------------------------------------------------------------------
    //! @brief      コンストラクタです.
    //-------------------------------------------------------------------------
    DiskShape();

    //-------------------------------------------------------------------------
    //! @brief      デストラクタです.
    //-------------------------------------------------------------------------
    ~DiskShape();

    //-------------------------------------------------------------------------
    //! @brief      初期化処理を行います.
    //-------------------------------------------------------------------------
    bool Init(ID3D12Device* pDevice, float radius, uint32_t sliceCount);

    //-------------------------------------------------------------------------
    //! @brief      終了処理を行います.
    //-------------------------------------------------------------------------
    void Term();
};

///////////////////////////////////////////////////////////////////////////////
// FanShape class
///////////////////////////////////////////////////////////////////////////////
class FanShape : public ShapeBase    /* 扇形 */
{
    //=========================================================================
    // list of friend classes and methods.
    //=========================================================================
    /* NOTHING */

public:
    //=========================================================================
    // public variables.
    //=========================================================================
    /* NOTHING */

    //=========================================================================
    // public methods.
    //=========================================================================

    //-------------------------------------------------------------------------
    //! @brief      コンストラクタです.
    //-------------------------------------------------------------------------
    FanShape();

    //-------------------------------------------------------------------------
    //! @brief      デストラクタです.
    //-------------------------------------------------------------------------
    ~FanShape();

    //-------------------------------------------------------------------------
    //! @brief      初期化処理を行います.
    //-------------------------------------------------------------------------
    bool Init(ID3D12Device* pDevice, float radius, float startAngleRad, float sweepAngleRad, uint32_t sliceCount);

    //-------------------------------------------------------------------------
    //! @brief      終了処理を行います.
    //-------------------------------------------------------------------------
    void Term();
};

///////////////////////////////////////////////////////////////////////////////
// BoneShape class
///////////////////////////////////////////////////////////////////////////////
class BoneShape : public ShapeBase
{
    //=========================================================================
    // list of friend classes and methods.
    //=========================================================================
    /* NOTHING */

public:
    //=========================================================================
    // public variables.
    //=========================================================================
    /* NOTHING */

    //=========================================================================
    // public methods.
    //=========================================================================

    //-------------------------------------------------------------------------
    //! @brief      コンストラクタです.
    //-------------------------------------------------------------------------
    BoneShape();

    //-------------------------------------------------------------------------
    //! @brief      デストラクタです.
    //-------------------------------------------------------------------------
    ~BoneShape();

    //-------------------------------------------------------------------------
    //! @brief      初期化処理を行います.
    //-------------------------------------------------------------------------
    bool Init(ID3D12Device* pDevice, float length, float width);

    //-------------------------------------------------------------------------
    //! @brief      終了処理を行います.
    //-------------------------------------------------------------------------
    void Term();
};


} // namespace asdx